<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lunabelle - Ù…ØªØ¬Ø± Ø¹Ø·ÙˆØ± ÙˆÙ…Ø³ØªØ­Ø¶Ø±Ø§Øª ØªØ¬Ù…ÙŠÙ„ ÙØ§Ø®Ø±Ø©</title>
  <meta name="description" content="ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ ÙØ§Ø®Ø±Ø© Ù„Ù„Ø¹Ø·ÙˆØ± ÙˆÙ…Ø³ØªØ­Ø¶Ø±Ø§Øª Ø§Ù„ØªØ¬Ù…ÙŠÙ„.">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            rose: {
              50: '#fff1f2',
              100: '#ffe4e6',
              200: '#fecdd3',
              300: '#fda4af',
              400: '#fb7185',
              500: '#f43f5e',
              600: '#e11d48',
              700: '#be123c',
              800: '#9f1239',
              900: '#881337',
            }
          }
        }
      }
    }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />

  <style>
    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0; padding: 0;
      font-family: 'Tajawal', sans-serif;
      direction: rtl;
      -webkit-font-smoothing: antialiased;
    }
    img { max-width: 100%; display: block; }
    button { cursor: pointer; }
    button:disabled { opacity: 0.7; cursor: not-allowed; }

    .primary-btn {
      display: inline-flex; align-items: center; gap: 0.4rem;
      background: linear-gradient(135deg, #fb7185, #e11d48, #9f1239);
      color: #ffffff; padding: 0.55rem 1.35rem;
      border-radius: 999px; font-size: 0.78rem; font-weight: 700;
      border: none; box-shadow: 0 12px 35px rgba(225, 29, 72, 0.25);
      transition: all 0.15s ease-out;
    }
    .primary-btn:hover { transform: translateY(-1px); filter: brightness(1.1); }

    .ghost-btn {
      border-radius: 999px; border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(255, 255, 255, 0.75); color: #475569;
      padding: 0.45rem 1.1rem; display: inline-flex; align-items: center;
      gap: 0.3rem; transition: all 0.15s ease-out;
    }
    .ghost-btn:hover { background: #be123c; border-color: #be123c; color: #fff; }

    .category-chip, .shop-tab {
      border-radius: 999px; border: 1px solid #e2e8f0;
      padding: 0.35rem 0.85rem; background: #f9fafb; color: #64748b;
      transition: all 0.15s ease-out;
    }
    .category-chip:hover, .shop-tab:hover { border-color: #fb7185; color: #be123c; background: #fff1f2; }
    .category-chip.active, .shop-tab.active { background: #be123c; color: #ffffff; border-color: #be123c; }

    .home-category-card {
      position: relative; border-radius: 1.5rem; overflow: hidden;
      transition: all 0.3s ease-in-out; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
    }
    .home-category-card:hover { transform: translateY(-8px); box-shadow: 0 18px 35px rgba(0, 0, 0, 0.1); }
    .home-category-card img { transition: transform 0.4s ease; }
    .home-category-card:hover img { transform: scale(1.1); }

    /* Header Navigation Link Style */
    .nav-link { position: relative; }
    .nav-link::after {
      content: ''; position: absolute; right: 0; bottom: -0.25rem;
      width: 0; height: 2px; background: #be123c; border-radius: 999px;
      transition: width 0.18s ease-out;
    }
    .nav-link:hover::after { width: 100%; }

    /* Product Card */
    .product-card {
      position: relative; border-radius: 1.25rem; border: 1px solid #e2e8f0;
      background: #ffffff; overflow: hidden; display: flex; flex-direction: column;
      transition: transform 0.18s ease-out, box-shadow 0.18s ease-out;
    }
    .product-card:hover { transform: translateY(-3px); box-shadow: 0 16px 45px rgba(190, 18, 60, 0.15); border-color: #fda4af; }
    .product-quick-add {
      position: absolute; left: 0.75rem; bottom: 0.75rem; right: 0.75rem;
      transform: translateY(120%); opacity: 0; transition: all 0.2s ease-out;
    }
    .product-card:hover .product-quick-add { transform: translateY(0); opacity: 1; }

    /* Variant Buttons */
    .variant-btn {
      font-size: 0.65rem; padding: 0.3rem 0.6rem; border-radius: 999px;
      border: 1px solid #e2e8f0; color: #64748b; background: #f8fafc;
      transition: all 0.15s ease-out;
    }
    .variant-btn:hover { border-color: #be123c; background: #fff; color: #be123c; }
    .variant-btn.active { background: #be123c; color: #ffffff; border-color: #be123c; font-weight: 700; }

    /* Social Icons */
    .social-icon {
      transition: transform 0.2s, color 0.2s; display: flex; align-items: center;
      justify-content: center; background-color: #fff1f2; border-radius: 50%;
      width: 48px; height: 48px; color: #9f1239; border: 1px solid #fecdd3;
    }
    .social-icon:hover {
      transform: scale(1.1) translateY(-3px); background-color: #be123c;
      color: #fff; border-color: #be123c; box-shadow: 0 4px 12px rgba(190, 18, 60, 0.2);
    }

    /* Drawers & Modals */
    #cartSidebar, #productDrawer { will-change: transform; }
    #backdrop.is-visible, #checkoutModal.is-visible, #successModal.is-visible { opacity: 1; pointer-events: auto; }
    
    /* Gallery Thumbs */
    .drawer-gallery-thumb {
        width: 60px; height: 60px; border-radius: 0.5rem; overflow: hidden;
        cursor: pointer; border: 2px solid transparent; opacity: 0.6; transition: all 0.2s;
    }
    .drawer-gallery-thumb.active { border-color: #be123c; opacity: 1; }

    /* Hero Section Dynamic Background */
    #heroSection {
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-image 0.5s ease;
    }
  </style>
</head>

<body class="bg-[#fdf2f8] text-slate-900 font-sans">
  <div id="app" class="min-h-screen flex flex-col">
    
    <header class="bg-white/80 backdrop-blur border-b border-rose-100 sticky top-0 z-40">
      <div class="container mx-auto px-4 lg:px-8">
        <div class="flex items-center justify-between py-3 lg:py-4 flex-row-reverse">
          
          <a href="#" data-nav="home" class="flex items-center gap-3">
            <img id="mainLogo"
                 src="images/logo.jpg" 
                 alt="Lunabelle" 
                 class="w-16 h-16 rounded-full object-cover border-2 border-rose-100 shadow-sm"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="w-16 h-16 rounded-full bg-rose-600 hidden items-center justify-center text-white font-bold text-xl shadow-sm border-2 border-white">LB</div>
          </a>

          <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
            <button data-nav="home" class="nav-link text-slate-700 hover:text-rose-600 transition">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button data-nav="about" class="nav-link text-slate-700 hover:text-rose-600 transition">Ù…Ù† Ù†Ø­Ù†</button>
            <button data-nav="contact" class="nav-link text-slate-700 hover:text-rose-600 transition">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</button>
          </nav>

          <div class="flex items-center gap-3">
            <button id="cartToggle" class="relative flex items-center justify-center w-10 h-10 rounded-full bg-rose-900 text-rose-100 hover:bg-rose-800 transition">
              <span class="material-symbols-outlined text-[20px]">shopping_bag</span>
              <span id="cartCount" class="absolute -top-1 -left-1 min-w-[18px] h-[18px] rounded-full bg-rose-500 text-[10px] text-white flex items-center justify-center font-bold shadow-sm">0</span>
            </button>
            <button id="mobileMenuToggle" class="md:hidden flex items-center justify-center w-9 h-9 rounded-full border border-rose-200 text-rose-600">
              <span class="material-symbols-outlined text-[22px]">menu</span>
            </button>
          </div>

        </div>

        <nav id="mobileNav" class="md:hidden hidden pb-3 px-4 border-t border-rose-100 mt-2 pt-2 text-sm">
          <div class="flex flex-col gap-2">
            <button data-nav="home" class="nav-link w-full text-right py-2 text-slate-700">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button data-nav="about" class="nav-link w-full text-right py-2 text-slate-700">Ù…Ù† Ù†Ø­Ù†</button>
            <button data-nav="contact" class="nav-link w-full text-right py-2 text-slate-700">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</button>
          </div>
        </nav>
      </div>
    </header>

    <main class="flex-1">

      <section id="page-home" class="page-section">
        <div id="heroSection" class="container mx-auto px-4 lg:px-8 py-10 lg:py-16">
          <div class="text-center mb-10 lg:mb-12 bg-white/60 backdrop-blur-sm p-6 rounded-2xl inline-block mx-auto shadow-sm">
            <h1 class="text-3xl lg:text-4xl font-extrabold text-rose-950 mb-2">Ø§ÙƒØªØ´ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø¬Ù…Ø§Ù„</h1>
            <p class="text-lg text-rose-800/80">ØªØ³ÙˆÙ‚ÙŠ Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø§ØªÙ†Ø§ Ø§Ù„ÙØ§Ø®Ø±Ø© Ù…Ù† Ø§Ù„Ø¹Ø·ÙˆØ±ØŒ Ø§Ù„Ù…ÙƒÙŠØ§Ø¬ØŒ ÙˆØ§Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø©.</p>
          </div>
          <div id="heroCategoriesContainer" class="flex overflow-x-auto snap-x snap-mandatory lg:grid lg:grid-cols-3 gap-6 lg:gap-8 lg:overflow-visible pb-4 lg:pb-0 no-scrollbar">
            </div>
        </div>

        <div id="section-about" class="bg-rose-50/50 py-16 lg:py-24 border-t border-rose-100">
          <div class="container mx-auto px-4 text-center max-w-2xl">
             <span class="text-rose-600 font-bold text-sm mb-2 block tracking-widest">Ø¹Ù† Ù„ÙˆÙ†Ø§Ø¨ÙŠÙ„</span>
            <h2 class="text-3xl lg:text-4xl font-extrabold mb-6 text-slate-900">Ù…Ù† Ù†Ø­Ù†</h2>
            <p class="text-slate-600 leading-relaxed text-lg mb-6">
              ÙÙŠ Ù„ÙˆÙ†Ø§Ø¨ÙŠÙ„ØŒ Ù†Ø¤Ù…Ù† Ø¨Ù‚ÙˆØ© Ø§Ù„Ø¬Ù…Ø§Ù„ Ø§Ù„ÙØ§Ø®Ø±. Ø¨Ø¯Ø£Øª Ø±Ø­Ù„ØªÙ†Ø§ Ø¨Ø´ØºÙ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£Ø±Ù‚Ù‰ Ø§Ù„Ø¹Ø·ÙˆØ± ÙˆÙ…Ø³ØªØ­Ø¶Ø±Ø§Øª Ø§Ù„ØªØ¬Ù…ÙŠÙ„ ÙˆÙ…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø©.
            </p>
          </div>
        </div>

        <div id="section-contact" class="bg-white py-16 lg:py-24 border-t border-rose-100">
          <div class="container mx-auto px-4 text-center max-w-lg">
            <span class="text-rose-600 font-bold text-sm mb-2 block tracking-widest">Ø§Ø¨Ù‚ÙŠ Ø¹Ù„Ù‰ ØªÙˆØ§ØµÙ„</span>
            <h2 class="text-3xl lg:text-4xl font-extrabold mb-6 text-slate-900">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h2>
            
            <div class="flex flex-wrap justify-center gap-4 mb-8">
                <a href="https://wa.me/201001120329" target="_blank" class="social-icon hover-whatsapp" title="WhatsApp">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.598 2.669-.698c1.009.55 2.18.895 3.422.895 3.178 0 5.767-2.587 5.767-5.766.001-3.182-2.585-5.768-5.768-5.768zm0-2c4.271 0 7.761 3.527 7.768 7.882 0 4.309-3.48 7.81-7.772 7.812-1.364.002-2.635-.35-3.737-1.049l-4.29.989.987-4.176c-.641-1.12-1.022-2.364-1.022-3.732 0-4.297 3.476-7.793 7.766-7.793l.304.007zm3.984 10.18c-.212-.107-1.254-.622-1.447-.695-.194-.072-.334-.109-.474.107-.141.214-.542.696-.665.838-.122.144-.246.16-.458.055-.212-.107-.896-.332-1.708-1.058-.631-.564-1.058-1.262-1.182-1.476-.123-.214-.013-.33.093-.436.097-.096.212-.249.318-.374.106-.124.141-.213.212-.355.07-.144.035-.267-.018-.374-.053-.107-.474-1.145-.649-1.568-.171-.413-.345-.357-.474-.364l-.403-.007c-.14 0-.369.054-.562.267-.193.213-.736.718-.736 1.752 0 1.034.754 2.032.859 2.173.106.143 1.483 2.274 3.596 3.184 1.769.762 2.128.61 2.516.572.388-.038 1.254-.513 1.429-1.007.175-.495.175-.918.123-1.007-.052-.089-.193-.143-.405-.25z"/></svg>
                </a>
                <a href="https://www.instagram.com/lunabelle.perfumes" target="_blank" class="social-icon hover-instagram" title="Instagram">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                </a>
                <a href="https://www.facebook.com/people/lunabelle/61573079371279/" target="_blank" class="social-icon hover-facebook" title="Facebook">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                </a>
                <a href="https://www.tiktok.com/@fatma_perfume" target="_blank" class="social-icon hover-tiktok" title="TikTok">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg>
                </a>
                <a href="https://youtube.com/@lunabelle_store" target="_blank" class="social-icon hover-youtube" title="YouTube">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                </a>
            </div>
          </div>
        </div>
      </section>

      <section id="page-shop" class="page-section bg-white border-b border-rose-100 hidden">
        <div class="container mx-auto px-4 lg:px-8 py-10 lg:py-12">
          <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 mb-6">
            <div>
              <h2 id="shopPageTitle" class="text-2xl lg:text-3xl font-bold mb-1 text-rose-950">ØªØ³ÙˆÙ‚ÙŠ</h2>
              <p class="text-sm text-rose-900/60 max-w-lg">Ø§ÙƒØªØ´ÙÙŠ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….</p>
            </div>
            <button data-nav="home" class="nav-link text-sm font-medium text-slate-700 hover:text-rose-600 transition inline-flex items-center gap-1 self-start lg:self-end">
              <span class="material-symbols-outlined text-base">chevron_right</span>
              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
          </div>

          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3 mb-5 text-xs">
            <div class="flex flex-wrap items-center gap-2">
               <button class="shop-tab" data-shop-tab="perfume">Ø¹Ø·ÙˆØ±</button>
               <button class="shop-tab" data-shop-tab="makeup">Ù…ÙƒÙŠØ§Ø¬</button>
               <button class="shop-tab" data-shop-tab="skincare">Ø¹Ù†Ø§ÙŠØ©</button>
            </div>
            <div class="flex items-center gap-2">
              <label class="inline-flex items-center gap-2 bg-rose-50 border border-rose-200 rounded-full px-3 py-1">
                <span class="text-rose-700">Ø§Ù„Ø³Ø¹Ø±</span>
                <select id="priceFilter" class="bg-transparent outline-none text-[11px] text-rose-900">
                  <option value="all">Ø§Ù„ÙƒÙ„</option>
                  <option value="0-500">Ø­ØªÙ‰ Ù¥Ù Ù </option>
                  <option value="500-1000">Ù¥Ù Ù  - Ù¡Ù Ù Ù </option>
                  <option value="1000+">Ù¡Ù Ù Ù +</option>
                </select>
              </label>
              <div class="flex items-center gap-2 bg-rose-50 border border-rose-200 rounded-full px-3 py-1">
                <span class="text-rose-700">ØªØ±ØªÙŠØ¨</span>
                <select id="sortSelect" class="bg-transparent outline-none text-[11px] text-rose-900">
                  <option value="featured">Ø§Ù„Ø£ÙƒØ«Ø± ØªÙ…ÙŠÙ‘Ø²Ù‹Ø§</option>
                  <option value="price-asc">Ø§Ù„Ø³Ø¹Ø±: Ø§Ù„Ø£Ù‚Ù„</option>
                  <option value="price-desc">Ø§Ù„Ø³Ø¹Ø±: Ø§Ù„Ø£Ø¹Ù„Ù‰</option>
                  <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
                </select>
              </div>
              <span id="resultsCount" class="text-[11px] text-rose-500">0 Ù…Ù†ØªØ¬</span>
            </div>
          </div>

          <div id="productsGrid" class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 lg:gap-5 min-h-[300px]"></div>
        </div>
      </section>

    </main>

    <section id="productDrawer" class="fixed inset-y-0 left-0 w-full max-w-md bg-white shadow-2xl transform -translate-x-full transition-transform duration-300 z-50 flex flex-col">
      <div class="flex items-center justify-between px-4 py-3 border-b border-rose-100 bg-white/95">
        <div class="flex items-center gap-2">
          <button id="productDrawerBack" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-rose-50 text-rose-800"><span class="material-symbols-outlined text-[20px]">chevron_right</span></button>
          <h2 class="text-sm font-semibold text-rose-900">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h2>
        </div>
        <button id="productDrawerClose" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-rose-50 text-rose-800"><span class="material-symbols-outlined text-[20px]">close</span></button>
      </div>
      <div class="flex-1 overflow-y-auto"><div id="productDetailContent" class="p-4"></div></div>
    </section>

    <aside id="cartSidebar" class="fixed inset-y-0 right-0 w-full sm:max-w-md bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50 flex flex-col">
      <div class="flex items-center justify-between px-4 py-3 border-b border-rose-100 bg-white/95">
        <div class="flex items-center gap-2">
          <button id="cartSidebarClose" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-rose-50 text-rose-800"><span class="material-symbols-outlined text-[20px]">chevron_right</span></button>
          <div>
            <h2 class="text-sm font-semibold text-rose-900">Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
            <p id="cartSidebarSubtitle" class="text-[11px] text-rose-500">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©</p>
          </div>
        </div>
      </div>
      <div class="flex-1 overflow-y-auto" id="cartItemsContainer"></div>
      <div class="border-t border-rose-100 bg-white/95 p-4 space-y-3 text-xs">
        <div class="flex items-center justify-between">
          <span class="text-rose-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
          <span id="cartSubtotal" class="font-bold text-rose-900">Ù  Ø¬Ù†ÙŠÙ‡</span>
        </div>
        <button id="openCheckoutModalBtn" class="primary-btn w-full justify-center">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
      </div>
    </aside>

    <div id="checkoutModal" class="fixed inset-0 z-[60] flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-200">
        <div class="bg-white w-full max-w-md mx-4 rounded-2xl shadow-2xl border border-rose-100 p-6 relative">
            <button id="closeCheckoutModal" class="absolute top-4 left-4 text-rose-400 hover:text-rose-700"><span class="material-symbols-outlined">close</span></button>
            <h3 class="text-xl font-bold text-rose-900 mb-4 text-center">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†</h3>
            <form id="checkoutForm" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-rose-700 mb-1">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="customerName" required class="form-input w-full" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
                </div>
                <div>
                    <label class="block text-xs font-bold text-rose-700 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="customerPhone" required class="form-input w-full" placeholder="01xxxxxxxxx">
                </div>
                <div>
                    <label class="block text-xs font-bold text-rose-700 mb-1">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„</label>
                    <textarea id="customerAddress" required class="form-input w-full h-24 resize-none" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ø§Ø±Ø©ØŒ Ø±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø©..."></textarea>
                </div>
                <div class="pt-2">
                    <button type="submit" id="confirmOrderBtn" class="primary-btn w-full justify-center py-3 text-sm">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            </form>
        </div>
    </div>

    <div id="successModal" class="fixed inset-0 z-[70] flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-200">
        <div class="bg-white w-full max-w-sm mx-4 rounded-2xl shadow-2xl border border-rose-100 p-8 text-center">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="material-symbols-outlined text-3xl">check_circle</span>
            </div>
            <h3 class="text-xl font-bold text-rose-900 mb-2">Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ!</h3>
            <p class="text-rose-700 text-sm mb-6">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ÙƒÙ… Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒÙ… ÙÙŠ Ø§Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ† ğŸ˜Š</p>
            <button id="closeSuccessModal" class="primary-btn w-full justify-center">Ù…ÙˆØ§ÙÙ‚</button>
        </div>
    </div>

    <div id="backdrop" class="fixed inset-0 bg-rose-900/20 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200 z-40"></div>

    <footer class="bg-rose-950 text-rose-100 mt-auto py-6 text-center text-xs">
      <p>Â© <span id="currentYear"></span> Lunabelle. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
    </footer>
  </div>

  <script>
    // --- Configuration ---
    // PASTE YOUR FORMSPREE URL HERE
    const FORMSPREE_ENDPOINT = "https://formspree.io/f/xkgegzvy"; 

    // Basic state
    const state = {
      products: [],
      fullCatalog: [],
      heroCategories: [],
      activeShopTab: 'perfume',
      activeCategoryFilter: 'all',
      searchQuery: '',
      priceFilter: 'all',
      sortMode: 'featured',
      cart: [],
    };

    // DOM refs
    const productsGrid = document.getElementById('productsGrid');
    const heroCategoriesContainer = document.getElementById('heroCategoriesContainer');
    const priceFilterEl = document.getElementById('priceFilter');
    const sortSelectEl = document.getElementById('sortSelect');
    const resultsCountEl = document.getElementById('resultsCount');
    const searchInputEl = document.getElementById('searchInput');
    const mobileSearchInputEl = document.getElementById('mobileSearchInput');
    const cartToggleEl = document.getElementById('cartToggle');
    const cartSidebarEl = document.getElementById('cartSidebar');
    const cartSidebarCloseEl = document.getElementById('cartSidebarClose');
    const cartItemsContainerEl = document.getElementById('cartItemsContainer');
    const cartCountEl = document.getElementById('cartCount');
    const cartSubtotalEl = document.getElementById('cartSubtotal');
    const openCheckoutModalBtn = document.getElementById('openCheckoutModalBtn');
    const checkoutModal = document.getElementById('checkoutModal');
    const closeCheckoutModal = document.getElementById('closeCheckoutModal');
    const checkoutForm = document.getElementById('checkoutForm');
    const successModal = document.getElementById('successModal');
    const closeSuccessModal = document.getElementById('closeSuccessModal');
    const productDrawerEl = document.getElementById('productDrawer');
    const productDetailContentEl = document.getElementById('productDetailContent');
    const productDrawerBackEl = document.getElementById('productDrawerBack');
    const productDrawerCloseEl = document.getElementById('productDrawerClose');
    const backdropEl = document.getElementById('backdrop');
    const currentYearEl = document.getElementById('currentYear');
    const mainLogoEl = document.getElementById('mainLogo');
    const heroSectionEl = document.getElementById('heroSection');

    const formatPrice = (value) => `${value.toLocaleString('ar-EG')} Ø¬Ù†ÙŠÙ‡`;

    // --- Fetch Data from JSON ---
    async function fetchData() {
      let data;
      try {
        // Attempt to fetch from file (for Production/GitHub)
        const response = await fetch('products.json');
        if(!response.ok) throw new Error("HTTP error " + response.status);
        data = await response.json();
      } catch (error) {
        // Fallback for Preview/Canvas
        console.log("Fetching failed (expected in preview), using fallback.");
        data = { hero_categories: [], products: {}, config: {} }; 
      }
      
      // 1. & 2. Apply Config (Logo & Background)
      if(data.config) {
          if(data.config.logo) {
              mainLogoEl.src = data.config.logo;
              // Force display incase onerror hid it previously
              mainLogoEl.style.display = 'block';
              // Hide fallback
              if(mainLogoEl.nextElementSibling) mainLogoEl.nextElementSibling.style.display = 'none';
          }
          if(data.config.hero_background) {
              heroSectionEl.style.backgroundImage = `url('${data.config.hero_background}')`;
          }
      }
      
      // Process Data
      state.heroCategories = data.hero_categories || [];
      renderHeroCategories();

      let flattenedProducts = [];
      if(data.products) {
          for (const [category, items] of Object.entries(data.products)) {
            items.forEach(item => {
              item.category = category;
              if(!item.images && item.image) item.images = [item.image];
              const prices = Object.values(item.sizes);
              item.basePrice = Math.min(...prices); 
              item.createdAt = item.isNew ? Date.now() : 0; 
              flattenedProducts.push(item);
            });
          }
      }
      state.fullCatalog = flattenedProducts;
      filterAndRenderProducts();
    }

    function renderHeroCategories() {
        if(!heroCategoriesContainer) return;
        const categories = (state.heroCategories && state.heroCategories.length > 0) 
            ? state.heroCategories 
            : [];

        heroCategoriesContainer.innerHTML = categories.map(cat => `
            <a href="#" data-navigate-shop="${cat.id}" class="home-category-card group aspect-[3/4] w-5/6 flex-shrink-0 snap-center lg:w-full">
              <img src="${cat.image}" alt="${cat.title}" class="w-full h-full object-cover">
              <div class="absolute inset-0 bg-gradient-to-t from-rose-900/80 to-transparent"></div>
              <div class="absolute bottom-0 left-0 right-0 p-6 text-white">
                <h2 class="text-2xl font-bold mb-2">${cat.title}</h2>
                <p class="text-sm opacity-90 mb-4">${cat.subtitle}</p>
                <span class="inline-flex items-center gap-2 text-sm font-bold bg-rose-600 text-white px-5 py-2 rounded-full group-hover:bg-white group-hover:text-rose-700 transition-colors">
                  ØªØµÙØ­ÙŠ Ø§Ù„Ø¢Ù†
                  <span class="material-symbols-outlined transition-transform group-hover:translate-x-[-4px]">arrow_back</span>
                </span>
              </div>
            </a>
        `).join('');

        // Re-attach listeners to dynamic category cards
        document.querySelectorAll('[data-navigate-shop]').forEach((el) => {
            el.addEventListener('click', (e) => {
                e.preventDefault();
                const target = el.getAttribute('data-navigate-shop');
                state.activeShopTab = target;
                // Replace direct DOM manipulation with Navigation wrapper
                navigateTo('shop');
            });
        });
    }

    // --- 3. History & Navigation Management ---
    
    // Helper to switch views
    function showView(viewName) {
        if (viewName === 'home') {
            document.getElementById('page-home').classList.remove('hidden');
            document.getElementById('page-shop').classList.add('hidden');
        } else if (viewName === 'shop') {
            document.getElementById('page-home').classList.add('hidden');
            document.getElementById('page-shop').classList.remove('hidden');
            updateFilterUI();
            filterAndRenderProducts();
        }
        window.scrollTo(0,0);
        document.getElementById('mobileNav').classList.add('hidden');
    }

    // Helper to handle history pushes
    function navigateTo(view) {
        showView(view);
        history.pushState({ view: view }, '', '');
    }

    function openDrawerWithHistory(type, data = null) {
        // Push state for the drawer
        history.pushState({ view: (document.getElementById('page-shop').classList.contains('hidden') ? 'home' : 'shop'), drawer: type, data: data }, '', '');
        
        if(type === 'product') _renderAndOpenProductDrawer(data);
        else if(type === 'cart') _openCartSidebar();
        else if(type === 'checkout') _openCheckoutModal();
    }

    // Handle Browser Back Button
    window.addEventListener('popstate', (event) => {
        const state = event.state;
        
        // Close all drawers/modals first
        closeDrawer(productDrawerEl, false); 
        _closeCartSidebar(false);
        _closeCheckout(false);
        
        if (!state) {
            // Default state (Home)
            showView('home');
        } else {
            // Restore View
            showView(state.view || 'home');
        }
    });

    // Initial History State
    history.replaceState({ view: 'home' }, '', '');


    // --- Navigation & Filters ---
    document.querySelectorAll('[data-nav]').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const key = btn.getAttribute('data-nav');
        if (key === 'home') {
            navigateTo('home');
        } else if (key === 'shop') {
            navigateTo('shop');
        } else {
            // For about/contact, staying on home but scrolling
            navigateTo('home'); 
            const mapping = { about: '#section-about', contact: '#section-contact' };
            setTimeout(() => {
                const target = document.querySelector(mapping[key]);
                if (target) target.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }
      });
    });

    document.getElementById('mobileMenuToggle')?.addEventListener('click', () => {
      document.getElementById('mobileNav').classList.toggle('hidden');
    });

    document.querySelectorAll('.shop-tab').forEach((btn) => {
      btn.addEventListener('click', () => {
        state.activeShopTab = btn.getAttribute('data-shop-tab');
        updateFilterUI();
        filterAndRenderProducts();
      });
    });

    function updateFilterUI() {
      document.querySelectorAll('.shop-tab').forEach(t => {
        t.classList.toggle('active', state.activeShopTab === t.getAttribute('data-shop-tab'));
      });
      const titleEl = document.getElementById('shopPageTitle');
      const titles = { perfume: 'Ø§Ù„Ø¹Ø·ÙˆØ±', makeup: 'Ø§Ù„Ù…ÙƒÙŠØ§Ø¬', skincare: 'Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø©' };
      if(titleEl) titleEl.textContent = titles[state.activeShopTab] || 'Ø§Ù„Ù…ØªØ¬Ø±';
    }

    priceFilterEl?.addEventListener('change', () => { state.priceFilter = priceFilterEl.value; filterAndRenderProducts(); });
    sortSelectEl?.addEventListener('change', () => { state.sortMode = sortSelectEl.value; filterAndRenderProducts(); });
    searchInputEl?.addEventListener('input', (e) => { state.searchQuery = e.target.value.trim(); filterAndRenderProducts(); });
    mobileSearchInputEl?.addEventListener('input', (e) => { state.searchQuery = e.target.value.trim(); filterAndRenderProducts(); });

    function filterAndRenderProducts() {
      let result = state.fullCatalog.filter(p => {
        if (state.activeShopTab && state.activeShopTab !== 'all' && p.category !== state.activeShopTab) return false;
        if (state.priceFilter !== 'all') {
          const [minStr, maxStr] = state.priceFilter.split('-');
          const min = parseInt(minStr) || 0;
          const max = maxStr === '+' ? Infinity : (parseInt(maxStr) || Infinity);
          if (p.basePrice < min || p.basePrice > max) return false;
        }
        if (state.searchQuery) {
          const q = state.searchQuery.toLowerCase();
          const searchStr = (p.name + p.description + (p.tags ? p.tags.join(' ') : '')).toLowerCase();
          if (!searchStr.includes(q)) return false;
        }
        return true;
      });

      if (state.sortMode === 'price-asc') result.sort((a,b) => a.basePrice - b.basePrice);
      else if (state.sortMode === 'price-desc') result.sort((a,b) => b.basePrice - a.basePrice);
      else if (state.sortMode === 'newest') result.sort((a,b) => b.createdAt - a.createdAt);
      else result.sort((a,b) => b.rating - a.rating);

      renderProductsGrid(result);
    }

    function renderProductsGrid(products) {
      productsGrid.innerHTML = '';
      resultsCountEl.textContent = `${products.length} Ù…Ù†ØªØ¬`;

      if (products.length === 0) {
        productsGrid.innerHTML = `<div class="col-span-full text-center py-10 text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø®ÙŠØ§Ø±Ø§ØªÙƒ.</div>`;
        return;
      }

      products.forEach(product => {
        const card = document.createElement('article');
        card.className = 'product-card group';
        
        const sizeKeys = Object.keys(product.sizes);
        let currentSize = sizeKeys[0];
        let currentPrice = product.sizes[currentSize];
        let currentShade = (product.shades && product.shades.length > 0) ? product.shades[0] : null;
        const mainImage = product.images && product.images.length > 0 ? product.images[0] : 'images/placeholder.jpg';

        // Buttons HTML
        const sizeButtonsHtml = sizeKeys.map(size => 
            `<button class="variant-btn size-btn ${size === currentSize ? 'active' : ''}" data-value="${size}">${size}</button>`
        ).join('');

        let shadeSectionHtml = '';
        if (product.shades && product.shades.length > 0) {
            const shadeButtonsHtml = product.shades.map(shade => 
                `<button class="variant-btn shade-btn ${shade === currentShade ? 'active' : ''}" data-value="${shade}">${shade}</button>`
            ).join('');
            shadeSectionHtml = `<div class="mt-2"><p class="text-[10px] text-slate-500 mb-1">Ø§Ù„Ø¯Ø±Ø¬Ø©:</p><div class="flex gap-1 flex-wrap">${shadeButtonsHtml}</div></div>`;
        }

        card.innerHTML = `
          <div class="relative overflow-hidden h-[230px]">
            <img src="${mainImage}" alt="${product.name}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" />
            ${product.isNew ? '<span class="absolute top-2 right-2 badge badge-new">Ø¬Ø¯ÙŠØ¯</span>' : ''}
            <button class="product-quick-add primary-btn text-[10px] px-2 py-1 absolute bottom-2 left-2 right-2 justify-center opacity-0 translate-y-4 transition-all group-hover:opacity-100 group-hover:translate-y-0">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
          </div>
          <div class="p-3 flex flex-col gap-1">
            <div><h3 class="text-sm font-bold text-slate-900 truncate">${product.name}</h3><p class="text-[10px] text-slate-500 mb-2">${product.category}</p></div>
            <div class="flex gap-1 flex-wrap sizes-container">${sizeButtonsHtml}</div>
            ${shadeSectionHtml}
            <div class="flex items-center justify-between mt-2">
               <span class="price-display text-sm font-bold text-rose-700">${formatPrice(currentPrice)}</span>
               <div class="flex items-center text-[10px] text-slate-400 gap-1"><span class="material-symbols-outlined text-[12px] text-rose-400">star</span>${product.rating}</div>
            </div>
          </div>
        `;
        
        // Listeners
        const priceDisplay = card.querySelector('.price-display');
        card.querySelectorAll('.size-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                card.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentSize = btn.getAttribute('data-value');
                currentPrice = product.sizes[currentSize];
                priceDisplay.textContent = formatPrice(currentPrice);
            });
        });
        card.querySelectorAll('.shade-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                card.querySelectorAll('.shade-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentShade = btn.getAttribute('data-value');
            });
        });
        card.querySelector('.product-quick-add').addEventListener('click', (e) => {
          e.stopPropagation();
          addToCart(product, currentSize, currentPrice, currentShade);
        });
        card.addEventListener('click', (e) => {
            if(!e.target.closest('button')) openProductDrawer(product);
        });
        
        productsGrid.appendChild(card);
      });
    }

    // --- Cart & Checkout ---
    function loadCartFromStorage() { try { state.cart = JSON.parse(localStorage.getItem('lunabelle_cart')) || []; } catch(e) { state.cart = []; } }
    function saveCart() { localStorage.setItem('lunabelle_cart', JSON.stringify(state.cart)); renderCart(); }

    function addToCart(product, size, price, shade) {
      const cartItemId = `${product.id}-${size}-${shade || 'none'}`;
      const existing = state.cart.find(i => i.cartItemId === cartItemId);
      const mainImage = product.images && product.images.length > 0 ? product.images[0] : 'images/placeholder.jpg';
      if (existing) existing.quantity++;
      else state.cart.push({ cartItemId, productId: product.id, name: product.name, size, shade, price, image: mainImage, quantity: 1 });
      saveCart();
      openCartSidebar();
    }

    function renderCart() {
      cartItemsContainerEl.innerHTML = '';
      let total = 0, count = 0;
      state.cart.forEach((item, idx) => {
        total += item.price * item.quantity; count += item.quantity;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <div class="cart-item-img"><img src="${item.image}" /></div>
          <div class="flex flex-col justify-center gap-1">
            <div class="text-xs font-bold text-slate-800">${item.name}</div>
            <div class="text-[10px] font-medium text-rose-700">Ø­Ø¬Ù…: ${item.size} ${item.shade ? '| ' + item.shade : ''}</div>
            <div class="text-[10px] text-slate-500">${formatPrice(item.price)} x ${item.quantity}</div>
            <button class="text-red-500 text-[10px] self-start hover:underline" data-idx="${idx}">Ø­Ø°Ù</button>
          </div>`;
        div.querySelector('button').addEventListener('click', () => { state.cart.splice(idx, 1); saveCart(); });
        cartItemsContainerEl.appendChild(div);
      });
      cartCountEl.textContent = count;
      cartSubtotalEl.textContent = formatPrice(total);
      document.getElementById('cartSidebarSubtitle').textContent = count === 0 ? 'Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©' : `${count} Ù…Ù†ØªØ¬Ø§Øª`;
    }

    // Cart & Drawer Logic Wrappers
    function openCartSidebar() { 
        openDrawerWithHistory('cart');
    }
    
    function _openCartSidebar() {
        cartSidebarEl.style.transform = 'translateX(0)'; 
        backdropEl.classList.add('is-visible');
    }
    
    function _closeCartSidebar(animate = true) { 
        cartSidebarEl.style.transform = 'translateX(100%)'; 
        if(productDrawerEl.style.transform !== 'translateX(0px)') backdropEl.classList.remove('is-visible'); 
    }

    function closeCartSidebar() { 
        // If user clicks X, go back in history (which triggers popstate -> _closeCartSidebar)
        if (history.state && history.state.drawer) {
            history.back();
        } else {
            _closeCartSidebar(); // Fallback
        }
    }
    
    cartToggleEl?.addEventListener('click', openCartSidebar);
    cartSidebarCloseEl?.addEventListener('click', closeCartSidebar);
    
    // Backdrop click handles multiple things
    backdropEl?.addEventListener('click', () => { 
        if(history.state && (history.state.drawer || history.state.modal)) {
            history.back();
        } else {
            // Fallback closures
             _closeCartSidebar(); 
             closeDrawer(productDrawerEl, false);
             _closeCheckout();
        }
    });

    // Checkout Modal Logic
    openCheckoutModalBtn?.addEventListener('click', () => {
        if(state.cart.length === 0) { alert('Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©!'); return; }
        openDrawerWithHistory('checkout');
    });
    
    function _openCheckoutModal() {
        _closeCartSidebar(false); // Visually close cart
        checkoutModal.classList.add('is-visible');
    }

    function closeCheckout() {
        if (history.state && history.state.drawer === 'checkout') {
            history.back();
        } else {
            _closeCheckout();
        }
    }
    
    function _closeCheckout(animate=true) {
        checkoutModal.classList.remove('is-visible');
        successModal.classList.remove('is-visible');
        if(animate && cartSidebarEl.style.transform !== 'translateX(0px)') backdropEl.classList.remove('is-visible');
    }
    
    closeCheckoutModal?.addEventListener('click', closeCheckout);
    closeSuccessModal?.addEventListener('click', closeCheckout);

    // Submit Order
    checkoutForm?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('confirmOrderBtn');
        const originalText = btn.textContent;
        btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
        btn.disabled = true;

        // Gather Data
        const name = document.getElementById('customerName').value;
        const phone = document.getElementById('customerPhone').value;
        const address = document.getElementById('customerAddress').value;

        let messageBody = `Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:\nØ§Ù„Ø§Ø³Ù…: ${name}\nØ§Ù„Ù‡Ø§ØªÙ: ${phone}\nØ§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}\n\nØ§Ù„Ø·Ù„Ø¨:\n`;
        state.cart.forEach(item => {
            messageBody += `- ${item.name} | ${item.size} ${item.shade ? ' | '+item.shade : ''} | x${item.quantity} | ${item.price * item.quantity} Ø¬.Ù…\n`;
        });
        messageBody += `\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${cartSubtotalEl.textContent}`;

        const formData = new FormData();
        formData.append("message", messageBody);
        formData.append("customer_name", name); // Helpful for Formspree filtering

        try {
            const response = await fetch(FORMSPREE_ENDPOINT, {
                method: 'POST', body: formData, headers: { 'Accept': 'application/json' }
            });
            if (response.ok) {
                state.cart = []; saveCart();
                checkoutForm.reset();
                checkoutModal.classList.remove('is-visible');
                successModal.classList.add('is-visible'); // Show Success
            } else {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.");
            }
        } catch (error) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„."); } 
        finally { btn.textContent = originalText; btn.disabled = false; }
    });

    // --- Product Drawer ---
    function openProductDrawer(product) {
        openDrawerWithHistory('product', product);
    }

    function _renderAndOpenProductDrawer(product) {
      if(!product) return;
      const sizeKeys = Object.keys(product.sizes);
      let selectedSize = sizeKeys[0], selectedPrice = product.sizes[selectedSize];
      let selectedShade = (product.shades && product.shades.length > 0) ? product.shades[0] : null;
      const images = product.images || ['images/placeholder.jpg'];

      const thumbs = images.length > 1 ? images.map((img, i) => `<div class="drawer-gallery-thumb ${i===0?'active':''}" data-src="${img}"><img src="${img}" /></div>`).join('') : '';
      const galleryHtml = images.length > 1 ? `<div class="drawer-gallery-thumbs">${thumbs}</div>` : '';

      const sizeButtonsHtml = sizeKeys.map(s => `<button class="variant-btn d-size ${s===selectedSize?'active':''}" data-val="${s}">${s}</button>`).join('');
      const shadeSectionHtml = product.shades?.length ? `<div class="mb-4"><label class="text-xs font-bold text-slate-700 block mb-2">Ø§Ù„Ø¯Ø±Ø¬Ø©:</label><div class="flex gap-2 flex-wrap">${product.shades.map(s => `<button class="variant-btn d-shade ${s===selectedShade?'active':''}" data-val="${s}">${s}</button>`).join('')}</div></div>` : '';

      productDetailContentEl.innerHTML = `
        <div class="mb-4"><img id="drawerMainImage" src="${images[0]}" class="w-full h-[300px] object-cover rounded-xl mb-2 shadow-sm" />${galleryHtml}</div>
        <h2 class="text-lg font-bold mb-2">${product.name}</h2><p class="text-sm text-slate-600 mb-4">${product.description}</p>
        <div class="mb-4"><label class="text-xs font-bold text-slate-700 block mb-2">Ø§Ù„Ø­Ø¬Ù…:</label><div class="flex gap-2 flex-wrap">${sizeButtonsHtml}</div></div>
        ${shadeSectionHtml}
        <div class="flex items-center justify-between mb-4"><span class="text-xs text-slate-500">Ø§Ù„Ø³Ø¹Ø±</span><div id="drawerPriceDisplay" class="font-bold text-xl text-rose-700">${formatPrice(selectedPrice)}</div></div>
        <button id="drawerAddToCart" class="primary-btn w-full justify-center py-3 text-sm">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>`;

      // Logic
      const mainImg = document.getElementById('drawerMainImage');
      const priceEl = document.getElementById('drawerPriceDisplay');
      productDetailContentEl.querySelectorAll('.drawer-gallery-thumb').forEach(th => th.addEventListener('click', () => {
          productDetailContentEl.querySelectorAll('.drawer-gallery-thumb').forEach(t => t.classList.remove('active'));
          th.classList.add('active'); mainImg.src = th.getAttribute('data-src');
      }));
      productDetailContentEl.querySelectorAll('.d-size').forEach(btn => btn.addEventListener('click', () => {
          productDetailContentEl.querySelectorAll('.d-size').forEach(b => b.classList.remove('active'));
          btn.classList.add('active'); selectedSize = btn.getAttribute('data-val'); selectedPrice = product.sizes[selectedSize]; priceEl.textContent = formatPrice(selectedPrice);
      }));
      productDetailContentEl.querySelectorAll('.d-shade').forEach(btn => btn.addEventListener('click', () => {
          productDetailContentEl.querySelectorAll('.d-shade').forEach(b => b.classList.remove('active'));
          btn.classList.add('active'); selectedShade = btn.getAttribute('data-val');
      }));
      // Fix: Ensure drawer closes via history back to maintain state sync
      document.getElementById('drawerAddToCart').addEventListener('click', () => { 
          addToCart(product, selectedSize, selectedPrice, selectedShade); 
          // After adding to cart, usually we open cart drawer, which pushes new state.
          // So we don't need to explicitly close this one, but let's be clean.
          // The 'openCartSidebar' call inside addToCart pushes a new state 'cart'.
      });

      productDrawerEl.style.transform = 'translateX(0)'; backdropEl.classList.add('is-visible');
    }

    function closeDrawer(el, animate=true) { 
        if(el) el.style.transform = 'translateX(-100%)'; 
        if(animate && cartSidebarEl.style.transform !== 'translateX(0px)') backdropEl.classList.remove('is-visible'); 
    }
    
    // When clicking X, go back
    productDrawerBackEl?.addEventListener('click', () => {
        if(history.state && history.state.drawer) history.back();
        else closeDrawer(productDrawerEl);
    });
    productDrawerCloseEl?.addEventListener('click', () => {
        if(history.state && history.state.drawer) history.back();
        else closeDrawer(productDrawerEl);
    });

    // Init
    window.addEventListener('DOMContentLoaded', () => {
      loadCartFromStorage(); renderCart(); fetchData();
      if(currentYearEl) currentYearEl.textContent = new Date().getFullYear();
    });
  </script>
</body>
</html>