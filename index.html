<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lunabelle - Ù…ØªØ¬Ø± Ø¹Ø·ÙˆØ± ÙˆÙ…Ø³ØªØ­Ø¶Ø±Ø§Øª ØªØ¬Ù…ÙŠÙ„ ÙØ§Ø®Ø±Ø©</title>
  <meta name="description" content="ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ ÙØ§Ø®Ø±Ø© Ù„Ù„Ø¹Ø·ÙˆØ± ÙˆÙ…Ø³ØªØ­Ø¶Ø±Ø§Øª Ø§Ù„ØªØ¬Ù…ÙŠÙ„.">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Tajawal', 'sans-serif'],
          },
          colors: {
            // New "Rose Gold" & "Champagne" Palette
            luna: {
              50: '#fdf8f6',  // Very light cream/pink
              100: '#fbeee6',
              200: '#f6dcd3', // Soft peach
              300: '#efb8a5',
              400: '#e58e73',
              500: '#d9644c',
              600: '#c2412e',
              700: '#a33024', // Deep warm red/brown
              800: '#872a23',
              900: '#712623',
              gold: '#D4AF37', // Classic Gold
              'gold-light': '#F3E5AB',
              'gold-dark': '#AA8C2C',
              'rose-gold': '#B76E79',
            },
            slate: {
              850: '#1f2937', // Softer black
            }
          }
        }
      }
    }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />

  <style>
    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0; padding: 0;
      font-family: 'Tajawal', sans-serif;
      direction: rtl;
      -webkit-font-smoothing: antialiased;
      background-color: #fdf8f6; /* Luna 50 */
      color: #4a4a4a;
    }
    img { max-width: 100%; display: block; }
    button { cursor: pointer; }
    button:disabled { opacity: 0.7; cursor: not-allowed; }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #fbeee6; }
    ::-webkit-scrollbar-thumb { background: #d4af37; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #aa8c2c; }

    /* Elegant Button Style - Rose Gold Gradient */
    .primary-btn {
      display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
      background: linear-gradient(135deg, #d4af37, #b76e79); /* Gold to Rose Gold */
      color: #ffffff; padding: 0.75rem 1.5rem;
      border-radius: 8px; font-size: 0.9rem; font-weight: 700;
      border: none; box-shadow: 0 4px 15px rgba(183, 110, 121, 0.3);
      transition: all 0.3s ease;
      letter-spacing: 0.5px;
    }
    .primary-btn:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 8px 20px rgba(183, 110, 121, 0.4); 
      filter: brightness(1.05);
    }

    .ghost-btn {
      border-radius: 8px; border: 1px solid #d4af37;
      background: transparent; color: #872a23;
      padding: 0.5rem 1.2rem; display: inline-flex; align-items: center;
      gap: 0.4rem; transition: all 0.2s ease;
      font-weight: 600;
    }
    .ghost-btn:hover { background: #fbeee6; }

    /* Chips & Tabs */
    .category-chip, .shop-tab {
      border-radius: 99px; border: 1px solid #f6dcd3;
      padding: 0.4rem 1.2rem; background: #ffffff; color: #872a23;
      transition: all 0.2s ease; cursor: pointer; font-size: 0.9rem;
    }
    .shop-tab:hover { border-color: #d4af37; color: #d4af37; background: #fff; }
    .shop-tab.active { 
      background: #d4af37; color: #ffffff; border-color: #d4af37; 
      box-shadow: 0 4px 10px rgba(212, 175, 55, 0.25);
    }

    /* Cards */
    .home-category-card {
      position: relative; border-radius: 1.5rem; overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    }
    .home-category-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(212, 175, 55, 0.15); }
    .home-category-card img { transition: transform 0.6s ease; }
    .home-category-card:hover img { transform: scale(1.08); }

    .product-card {
      position: relative; border-radius: 1rem; border: none;
      background: #ffffff; overflow: hidden; display: flex; flex-direction: column;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.03);
    }
    .product-card:hover { 
      transform: translateY(-5px); 
      box-shadow: 0 15px 35px rgba(183, 110, 121, 0.15); 
    }

    /* Navigation */
    .nav-link { position: relative; color: #4a4a4a; font-weight: 500; }
    .nav-link::after {
      content: ''; position: absolute; right: 0; bottom: -4px;
      width: 0; height: 2px; background: #d4af37;
      transition: width 0.3s ease;
    }
    .nav-link:hover { color: #d4af37; }
    .nav-link:hover::after { width: 100%; }

    /* Variant Buttons */
    .variant-btn {
      font-size: 0.75rem; padding: 0.35rem 0.75rem; border-radius: 6px;
      border: 1px solid #f2f2f2; color: #666; background: #fcfcfc;
      transition: all 0.2s ease;
    }
    .variant-btn:hover { border-color: #d4af37; color: #d4af37; }
    .variant-btn.active { background: #d4af37; color: #ffffff; border-color: #d4af37; }

    /* Social Icons */
    .social-icon {
      transition: all 0.3s; display: flex; align-items: center;
      justify-content: center; background-color: #ffffff; border-radius: 50%;
      width: 50px; height: 50px; color: #d4af37; 
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .social-icon:hover {
      transform: scale(1.1) rotate(5deg); background-color: #d4af37;
      color: #fff; box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
    }

    /* Floating Actions */
    .floating-btn {
      position: fixed; z-index: 90; 
      width: 50px; height: 50px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      cursor: pointer; opacity: 0; pointer-events: none; transform: scale(0.8);
    }
    .floating-btn.visible { opacity: 1; pointer-events: auto; transform: scale(1); }
    .floating-btn:hover { transform: scale(1.1); }
    
    #scrollTopBtn { 
      bottom: 2rem; right: 2rem; 
      background: white; color: #d4af37; border: 1px solid #f6dcd3;
    }
    #floatingWhatsapp {
      bottom: 6rem; right: 2rem;
      background: #25D366; color: white;
    }

    /* Gallery Styles */
    .gallery-container { position: relative; overflow: hidden; border-radius: 1rem; background: #f9f9f9; }
    .gallery-slide { display: flex; transition: transform 0.3s ease-out; height: 100%; }
    .gallery-img { 
        min-width: 100%; height: 100%; object-fit: contain; /* Changed to contain to see full product */
        background: #fff;
    }
    .gallery-nav-btn {
        position: absolute; top: 50%; transform: translateY(-50%);
        width: 36px; height: 36px; border-radius: 50%;
        background: rgba(255,255,255,0.8); color: #333;
        display: flex; items-center; justify-content: center;
        cursor: pointer; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        z-index: 10; transition: background 0.2s;
    }
    .gallery-nav-btn:hover { background: white; color: #d4af37; }
    .gallery-prev { left: 10px; }
    .gallery-next { right: 10px; }
    .gallery-dots {
        position: absolute; bottom: 10px; left: 0; right: 0;
        display: flex; justify-content: center; gap: 6px; z-index: 10;
    }
    .gallery-dot {
        width: 8px; height: 8px; border-radius: 50%; background: rgba(0,0,0,0.2);
        transition: all 0.3s;
    }
    .gallery-dot.active { background: #d4af37; transform: scale(1.2); }

    /* Modals */
    #backdrop.is-visible, #checkoutModal.is-visible, #successModal.is-visible { opacity: 1; pointer-events: auto; }
    #cartSidebar { will-change: transform; }

    /* Animations */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in-up { animation: fadeIn 0.4s ease-out forwards; }

    /* Hide scrollbar for gallery but keep swipe */
    .hide-scroll::-webkit-scrollbar { display: none; }
  </style>
</head>

<body class="bg-luna-50 text-slate-800 font-sans">
  <div id="app" class="min-h-screen flex flex-col">
    
    <!-- HEADER -->
    <header class="bg-white/90 backdrop-blur-md border-b border-luna-200 sticky top-0 z-40 h-[85px] shadow-sm">
      <div class="container mx-auto px-4 lg:px-8 h-full relative">
        <div class="flex items-center justify-between h-full">
          
          <!-- RIGHT SECTION (Search & Nav) -->
          <div class="flex items-center gap-4 lg:gap-6">
            <button id="mobileMenuToggle" class="md:hidden flex items-center justify-center w-10 h-10 rounded-full bg-luna-50 text-luna-800 hover:bg-luna-100 transition">
              <span class="material-symbols-outlined text-[24px]">menu</span>
            </button>

            <nav class="hidden md:flex items-center gap-8 text-sm font-medium">
              <button data-nav="home" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
              <button data-nav="shop" class="nav-link">Ø§Ù„Ù…ØªØ¬Ø±</button>
              <button data-nav="about" class="nav-link">Ù…Ù† Ù†Ø­Ù†</button>
              <button data-nav="contact" class="nav-link">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</button>
            </nav>

            <div class="hidden md:flex items-center relative group">
              <input 
                type="text" 
                id="searchInput" 
                placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù†..." 
                class="rounded-full border border-luna-200 pl-4 pr-10 py-2 text-xs focus:outline-none focus:border-luna-gold focus:ring-1 focus:ring-luna-gold w-40 bg-luna-50 transition-all focus:w-56 text-luna-900"
              >
              <span class="material-symbols-outlined absolute right-3 top-1/2 transform -translate-y-1/2 text-luna-400 text-[18px] pointer-events-none group-focus-within:text-luna-gold">search</span>
            </div>
          </div>

          <!-- CENTER SECTION (Logo) -->
          <div class="absolute left-1/2 top-0 transform -translate-x-1/2 z-50 mt-2">
            <a href="#" data-nav="home" class="block group relative">
              <div class="absolute inset-0 bg-white rounded-full blur-md opacity-50 group-hover:opacity-80 transition"></div>
              <img id="mainLogo"
                   src="logo.jpg" 
                   alt="Lunabelle" 
                   class="w-24 h-24 lg:w-32 lg:h-32 rounded-full object-cover border-4 border-white shadow-xl group-hover:scale-105 transition-transform duration-500 relative z-10"
                   onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              <div class="w-28 h-28 rounded-full bg-luna-gold hidden items-center justify-center text-white font-bold text-3xl shadow-lg border-4 border-white z-10">LB</div>
            </a>
          </div>

          <!-- LEFT SECTION (Cart) -->
          <div class="flex items-center gap-3">
            <button id="cartToggle" class="relative flex items-center justify-center w-11 h-11 rounded-full text-luna-800 hover:bg-luna-50 border border-transparent hover:border-luna-100 transition group">
              <span class="material-symbols-outlined text-[26px] group-hover:text-luna-gold transition-colors">shopping_bag</span>
              <span id="cartCount" class="absolute top-0 left-0 min-w-[20px] h-[20px] rounded-full bg-luna-gold text-[11px] text-white flex items-center justify-center font-bold shadow-md border-2 border-white transform scale-0 transition-transform duration-300">0</span>
            </button>
          </div>
        </div>

        <!-- Mobile Menu -->
        <nav id="mobileNav" class="md:hidden hidden pb-6 px-5 border-t border-luna-100 mt-0 pt-6 text-sm bg-white absolute top-full left-0 right-0 shadow-xl z-40 rounded-b-3xl">
            <div class="relative mb-5">
              <input 
                type="text" 
                id="mobileSearchInput" 
                placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ù…Ù†ØªØ¬..." 
                class="w-full rounded-full border border-luna-200 pr-10 pl-4 py-3 text-sm focus:outline-none focus:border-luna-gold bg-luna-50 text-luna-900"
              >
              <span class="material-symbols-outlined absolute right-3 top-1/2 transform -translate-y-1/2 text-luna-400 text-[20px]">search</span>
            </div>
            <div class="flex flex-col gap-1">
                <button data-nav="home" class="nav-link w-full text-right py-3 border-b border-dashed border-luna-100">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button data-nav="shop" class="nav-link w-full text-right py-3 border-b border-dashed border-luna-100">Ø§Ù„Ù…ØªØ¬Ø±</button>
                <button data-nav="about" class="nav-link w-full text-right py-3 border-b border-dashed border-luna-100">Ù…Ù† Ù†Ø­Ù†</button>
                <button data-nav="contact" class="nav-link w-full text-right py-3">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</button>
            </div>
        </nav>
      </div>
    </header>

    <main class="flex-1"> 

      <!-- PAGE: HOME -->
      <section id="page-home" class="page-section fade-in-up">
        <div class="container mx-auto px-4 lg:px-8 py-8 lg:py-12 mt-4">
          <!-- Hero Title Removed as requested -->
          <!-- Simple Welcoming Divider -->
          <div class="flex items-center justify-center gap-4 mb-8 opacity-60">
             <div class="h-[1px] w-12 bg-luna-gold"></div>
             <span class="text-xs tracking-[0.2em] text-luna-800 uppercase">Original Store</span>
             <div class="h-[1px] w-12 bg-luna-gold"></div>
          </div>

          <div id="heroCategoriesContainer" class="flex flex-col gap-6 lg:grid lg:grid-cols-3 lg:gap-8">
            <!-- Categories injected by JS -->
          </div>
        </div>

        <div id="section-about" class="bg-white py-16 border-t border-luna-100 relative overflow-hidden">
          <div class="absolute top-0 right-0 -mr-20 -mt-20 w-64 h-64 bg-luna-100 rounded-full blur-3xl opacity-50"></div>
          <div class="container mx-auto px-4 text-center max-w-2xl relative z-10">
             <span class="text-luna-gold font-bold text-xs mb-3 block tracking-widest uppercase">Ù‚ØµØªÙ†Ø§</span>
            <h2 class="text-3xl font-bold mb-6 text-luna-900">Ù…Ù† Ù†Ø­Ù†</h2>
            <p class="text-slate-600 leading-loose text-lg mb-6 font-light">
              ÙÙŠ Ù„ÙˆÙ†Ø§Ø¨ÙŠÙ„ØŒ Ù†Ø¤Ù…Ù† Ø£Ù† Ø§Ù„Ø¬Ù…Ø§Ù„ Ù‡Ùˆ Ø§Ù†Ø¹ÙƒØ§Ø³ Ù„Ù„Ø±ÙˆØ­. Ø¨Ø¯Ø£Øª Ø±Ø­Ù„ØªÙ†Ø§ Ø¨Ø´ØºÙ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£Ø±Ù‚Ù‰ Ø§Ù„Ø¹Ø·ÙˆØ± ÙˆÙ…Ø³ØªØ­Ø¶Ø±Ø§Øª Ø§Ù„ØªØ¬Ù…ÙŠÙ„ Ø§Ù„ØªÙŠ ØªÙ„ÙŠÙ‚ Ø¨Ø¬Ù…Ø§Ù„ÙƒÙ Ø§Ù„ÙØ±ÙŠØ¯. ÙƒÙ„ Ù‚Ø·Ø¹Ø© Ù„Ø¯ÙŠÙ†Ø§ Ù‡ÙŠ Ù‚ØµØ© ÙØ®Ø§Ù…Ø© ØªÙØ±ÙˆÙ‰.
            </p>
          </div>
        </div>

        <div id="section-contact" class="bg-luna-50 py-16 border-t border-luna-200">
          <div class="container mx-auto px-4 text-center max-w-lg">
            <span class="text-luna-gold font-bold text-xs mb-3 block tracking-widest uppercase">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</span>
            <h2 class="text-3xl font-bold mb-8 text-luna-900">Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ø£Ø¬Ù„Ùƒ</h2>
            
            <div class="flex flex-wrap justify-center gap-6">
                <!-- Social Icons from user file -->
                <a href="https://wa.me/201001120329" target="_blank" class="social-icon" title="WhatsApp">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.598 2.669-.698c1.009.55 2.18.895 3.422.895 3.178 0 5.767-2.587 5.767-5.766.001-3.182-2.585-5.768-5.768-5.768zm0-2c4.271 0 7.761 3.527 7.768 7.882 0 4.309-3.48 7.81-7.772 7.812-1.364.002-2.635-.35-3.737-1.049l-4.29.989.987-4.176c-.641-1.12-1.022-2.364-1.022-3.732 0-4.297 3.476-7.793 7.766-7.793l.304.007zm3.984 10.18c-.212-.107-1.254-.622-1.447-.695-.194-.072-.334-.109-.474.107-.141.214-.542.696-.665.838-.122.144-.246.16-.458.055-.212-.107-.896-.332-1.708-1.058-.631-.564-1.058-1.262-1.182-1.476-.123-.214-.013-.33.093-.436.097-.096.212-.249.318-.374.106-.124.141-.213.212-.355.07-.144.035-.267-.018-.374-.053-.107-.474-1.145-.649-1.568-.171-.413-.345-.357-.474-.364l-.403-.007c-.14 0-.369.054-.562.267-.193.213-.736.718-.736 1.752 0 1.034.754 2.032.859 2.173.106.143 1.483 2.274 3.596 3.184 1.769.762 2.128.61 2.516.572.388-.038 1.254-.513 1.429-1.007.175-.495.175-.918.123-1.007-.052-.089-.193-.143-.405-.25z"/></svg>
                </a>
                <a href="https://www.instagram.com/lunabelle.perfumes" target="_blank" class="social-icon" title="Instagram">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                </a>
                <a href="https://www.facebook.com/people/lunabelle/61573079371279/" target="_blank" class="social-icon" title="Facebook">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                </a>
                <a href="https://www.tiktok.com/@fatma_perfume" target="_blank" class="social-icon" title="TikTok">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg>
                </a>
                <a href="https://youtube.com/@lunabelle_store" target="_blank" class="social-icon" title="YouTube">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                </a>
            </div>
          </div>
        </div>
      </section>

      <!-- PAGE: SHOP -->
      <section id="page-shop" class="page-section hidden fade-in-up">
        <div class="container mx-auto px-4 lg:px-8 py-10 lg:py-12">
          <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 mb-8">
            <div>
              <h2 id="shopPageTitle" class="text-3xl font-bold mb-1 text-luna-800">ØªØ³ÙˆÙ‚ÙŠ</h2>
              <p class="text-sm text-slate-500 max-w-lg">Ø§ÙƒØªØ´ÙÙŠ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø¹Ù†Ø§ÙŠØ©.</p>
            </div>
          </div>

          <!-- Filters -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border border-luna-100 mb-8 sticky top-[90px] z-30">
              <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 text-xs">
                <div class="flex flex-wrap items-center gap-2">
                   <button class="shop-tab active" data-shop-tab="perfume">Ø§Ù„Ø¹Ø·ÙˆØ±</button>
                   <button class="shop-tab" data-shop-tab="makeup">Ø§Ù„Ù…ÙƒÙŠØ§Ø¬</button>
                   <button class="shop-tab" data-shop-tab="skincare">Ø§Ù„Ø¹Ù†Ø§ÙŠØ©</button>
                </div>
                <div class="flex flex-wrap items-center gap-2">
                  <div class="flex items-center gap-2 bg-luna-50 border border-luna-200 rounded-full px-4 py-2">
                    <span class="text-luna-700 font-bold">Ø§Ù„Ø³Ø¹Ø±:</span>
                    <select id="priceFilter" class="bg-transparent outline-none text-slate-700 cursor-pointer">
                      <option value="all">Ø§Ù„ÙƒÙ„</option>
                      <option value="0-500">Ø£Ù‚Ù„ Ù…Ù† Ù¥Ù Ù </option>
                      <option value="500-1000">Ù¥Ù Ù  - Ù¡Ù Ù Ù </option>
                      <option value="1000+">Ø£ÙƒØ«Ø± Ù…Ù† Ù¡Ù Ù Ù </option>
                    </select>
                  </div>
                  <div class="flex items-center gap-2 bg-luna-50 border border-luna-200 rounded-full px-4 py-2">
                    <span class="text-luna-700 font-bold">ØªØ±ØªÙŠØ¨:</span>
                    <select id="sortSelect" class="bg-transparent outline-none text-slate-700 cursor-pointer">
                      <option value="featured">Ø§Ù„Ø£ÙƒØ«Ø± ØªÙ…ÙŠÙ‘Ø²Ù‹Ø§</option>
                      <option value="price-asc">Ø§Ù„Ø£Ù‚Ù„ Ø³Ø¹Ø±Ù‹Ø§</option>
                      <option value="price-desc">Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø±Ù‹Ø§</option>
                      <option value="newest">ÙˆØµÙ„ Ø­Ø¯ÙŠØ«Ù‹Ø§</option>
                    </select>
                  </div>
                </div>
              </div>
          </div>

          <div id="productsGrid" class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 lg:gap-8 min-h-[400px]"></div>
        </div>
      </section>

      <!-- PAGE: PRODUCT DETAILS (Dedicated Page) -->
      <section id="page-product" class="page-section hidden fade-in-up bg-white min-h-screen">
          <div class="container mx-auto px-4 lg:px-8 py-8 lg:py-12">
            <!-- Breadcrumb / Back -->
            <button id="backToShopBtn" class="mb-6 flex items-center text-sm text-luna-800 hover:text-luna-gold transition font-bold">
                <span class="material-symbols-outlined text-lg ml-1">arrow_forward</span>
                Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±
            </button>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16">
                <!-- Gallery Section -->
                <div class="relative">
                    <div id="productGallery" class="gallery-container w-full aspect-square lg:aspect-[4/3] bg-luna-50 mb-4 relative touch-pan-y">
                        <!-- Images injected here -->
                        <div class="gallery-wrapper h-full w-full relative overflow-hidden">
                             <div id="galleryTrack" class="gallery-slide"></div>
                        </div>
                        
                        <!-- Navigation Arrows -->
                        <button id="galleryPrev" class="gallery-nav-btn gallery-prev hidden"><span class="material-symbols-outlined">chevron_right</span></button>
                        <button id="galleryNext" class="gallery-nav-btn gallery-next hidden"><span class="material-symbols-outlined">chevron_left</span></button>
                        
                        <!-- Dots -->
                        <div id="galleryDots" class="gallery-dots"></div>
                    </div>
                    <!-- Thumbnails -->
                    <div id="galleryThumbs" class="flex gap-2 overflow-x-auto pb-2 hide-scroll"></div>
                </div>

                <!-- Product Info Section -->
                <div class="flex flex-col">
                    <div class="border-b border-luna-100 pb-6 mb-6">
                        <span id="detailCategory" class="text-xs font-bold text-luna-gold uppercase tracking-wider mb-2 block"></span>
                        <h1 id="detailName" class="text-2xl lg:text-4xl font-bold text-luna-900 mb-3 leading-tight"></h1>
                        <p id="detailDesc" class="text-slate-600 text-lg leading-relaxed"></p>
                    </div>

                    <div class="space-y-6">
                        <!-- Options -->
                        <div id="detailOptions"></div>

                        <!-- Price & Add -->
                        <div class="bg-luna-50 p-6 rounded-2xl border border-luna-100 mt-4">
                            <div class="flex items-end justify-between mb-6">
                                <div>
                                    <span class="text-sm text-slate-500 block mb-1">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                                    <span id="detailPrice" class="text-3xl font-bold text-luna-700"></span>
                                </div>
                            </div>
                            <button id="detailAddToCart" class="primary-btn w-full py-4 text-lg shadow-lg">
                                <span class="material-symbols-outlined">shopping_bag</span>
                                Ø¥Ø¶Ø§ÙØ© Ù„Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚
                            </button>
                        </div>
                    </div>
                </div>
            </div>
          </div>
      </section>

    </main>

    <!-- Floating Actions -->
    <div id="scrollTopBtn" class="floating-btn" title="Scroll Top">
        <span class="material-symbols-outlined">arrow_upward</span>
    </div>

    <a id="floatingWhatsapp" href="https://wa.me/201001120329" target="_blank" class="floating-btn" title="WhatsApp Us">
         <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.598 2.669-.698c1.009.55 2.18.895 3.422.895 3.178 0 5.767-2.587 5.767-5.766.001-3.182-2.585-5.768-5.768-5.768zm0-2c4.271 0 7.761 3.527 7.768 7.882 0 4.309-3.48 7.81-7.772 7.812-1.364.002-2.635-.35-3.737-1.049l-4.29.989.987-4.176c-.641-1.12-1.022-2.364-1.022-3.732 0-4.297 3.476-7.793 7.766-7.793l.304.007zm3.984 10.18c-.212-.107-1.254-.622-1.447-.695-.194-.072-.334-.109-.474.107-.141.214-.542.696-.665.838-.122.144-.246.16-.458.055-.212-.107-.896-.332-1.708-1.058-.631-.564-1.058-1.262-1.182-1.476-.123-.214-.013-.33.093-.436.097-.096.212-.249.318-.374.106-.124.141-.213.212-.355.07-.144.035-.267-.018-.374-.053-.107-.474-1.145-.649-1.568-.171-.413-.345-.357-.474-.364l-.403-.007c-.14 0-.369.054-.562.267-.193.213-.736.718-.736 1.752 0 1.034.754 2.032.859 2.173.106.143 1.483 2.274 3.596 3.184 1.769.762 2.128.61 2.516.572.388-.038 1.254-.513 1.429-1.007.175-.495.175-.918.123-1.007-.052-.089-.193-.143-.405-.25z"/></svg>
    </a>

    <!-- CART SIDEBAR -->
    <aside id="cartSidebar" class="fixed inset-y-0 right-0 w-full sm:max-w-md bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50 flex flex-col">
      <div class="flex items-center justify-between px-6 py-4 border-b border-luna-100 bg-white">
        <div class="flex items-center gap-3">
          <button id="cartSidebarClose" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-luna-50 text-luna-800 transition"><span class="material-symbols-outlined">chevron_right</span></button>
          <div>
            <h2 class="text-lg font-bold text-luna-900">Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
            <p id="cartSidebarSubtitle" class="text-xs text-luna-gold font-medium">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©</p>
          </div>
        </div>
      </div>
      <div class="flex-1 overflow-y-auto p-4 space-y-4" id="cartItemsContainer"></div>
      <div class="border-t border-luna-100 bg-luna-50/50 p-6 space-y-4">
        <div class="flex items-center justify-between text-lg font-bold">
          <span class="text-luna-800">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
          <span id="cartSubtotal" class="text-luna-600">0 Ø¬Ù†ÙŠÙ‡</span>
        </div>
        <button id="openCheckoutModalBtn" class="primary-btn w-full justify-center py-3">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
      </div>
    </aside>

    <!-- CHECKOUT MODAL -->
    <div id="checkoutModal" class="fixed inset-0 z-[60] flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300 px-4">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl border border-luna-100 p-8 relative scale-95 transition-transform duration-300" id="checkoutContent">
            <button id="closeCheckoutModal" class="absolute top-4 left-4 text-luna-300 hover:text-luna-700 transition"><span class="material-symbols-outlined">close</span></button>
            <h3 class="text-2xl font-bold text-luna-900 mb-6 text-center">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†</h3>
            <form id="checkoutForm" class="space-y-5">
                <div>
                    <label class="block text-xs font-bold text-luna-700 mb-1.5 uppercase tracking-wide">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="customerName" required class="w-full rounded-lg border border-luna-200 px-4 py-3 focus:border-luna-gold focus:ring-1 focus:ring-luna-gold outline-none transition" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
                </div>
                <div>
                    <label class="block text-xs font-bold text-luna-700 mb-1.5 uppercase tracking-wide">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="customerPhone" required class="w-full rounded-lg border border-luna-200 px-4 py-3 focus:border-luna-gold focus:ring-1 focus:ring-luna-gold outline-none transition" placeholder="01xxxxxxxxx">
                </div>
                <div>
                    <label class="block text-xs font-bold text-luna-700 mb-1.5 uppercase tracking-wide">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„</label>
                    <textarea id="customerAddress" required class="w-full rounded-lg border border-luna-200 px-4 py-3 h-24 resize-none focus:border-luna-gold focus:ring-1 focus:ring-luna-gold outline-none transition" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ø§Ø±Ø©ØŒ Ø±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø©..."></textarea>
                </div>
                <div class="pt-2">
                    <button type="submit" id="confirmOrderBtn" class="primary-btn w-full justify-center py-3.5">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            </form>
        </div>
    </div>

    <!-- SUCCESS MODAL -->
    <div id="successModal" class="fixed inset-0 z-[70] flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300 px-4">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl border border-luna-100 p-8 text-center scale-95">
            <div class="w-20 h-20 bg-green-50 text-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="material-symbols-outlined text-4xl">check_circle</span>
            </div>
            <h3 class="text-2xl font-bold text-luna-900 mb-2">Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ!</h3>
            <p class="text-slate-600 mb-8 leading-relaxed">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙƒÙ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø­Ù†. ğŸŒ¸</p>
            <button id="closeSuccessModal" class="primary-btn w-full justify-center">Ù…ÙˆØ§ÙÙ‚</button>
        </div>
    </div>

    <div id="backdrop" class="fixed inset-0 bg-slate-900/30 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300 z-40"></div>

    <footer class="bg-white border-t border-luna-100 mt-auto py-8 text-center text-xs text-slate-400">
      <div class="flex items-center justify-center gap-2 mb-4 opacity-70">
          <span class="w-2 h-2 rounded-full bg-luna-gold"></span>
          <span class="w-2 h-2 rounded-full bg-luna-300"></span>
          <span class="w-2 h-2 rounded-full bg-luna-gold"></span>
      </div>
      <p>Â© <span id="currentYear"></span> Lunabelle. ØµÙ†Ø¹ Ø¨Ø­Ø¨.</p>
    </footer>
  </div>

  <script>
    // --- Configuration ---
    const FORMSPREE_ENDPOINT = "https://formspree.io/f/xkgegzvy"; 

    // Basic state
    const state = {
      products: [],
      fullCatalog: [],
      heroCategories: [],
      activeShopTab: 'perfume',
      activeCategoryFilter: 'all',
      searchQuery: '',
      priceFilter: 'all',
      sortMode: 'featured',
      cart: [],
      currentProduct: null, // For detail view
      currentGalleryIndex: 0
    };

    // DOM refs
    const productsGrid = document.getElementById('productsGrid');
    const heroCategoriesContainer = document.getElementById('heroCategoriesContainer');
    const priceFilterEl = document.getElementById('priceFilter');
    const sortSelectEl = document.getElementById('sortSelect');
    const searchInputEl = document.getElementById('searchInput');
    const mobileSearchInputEl = document.getElementById('mobileSearchInput');
    const cartToggleEl = document.getElementById('cartToggle');
    const cartSidebarEl = document.getElementById('cartSidebar');
    const cartSidebarCloseEl = document.getElementById('cartSidebarClose');
    const cartItemsContainerEl = document.getElementById('cartItemsContainer');
    const cartCountEl = document.getElementById('cartCount');
    const cartSubtotalEl = document.getElementById('cartSubtotal');
    const openCheckoutModalBtn = document.getElementById('openCheckoutModalBtn');
    const checkoutModal = document.getElementById('checkoutModal');
    const closeCheckoutModal = document.getElementById('closeCheckoutModal');
    const checkoutForm = document.getElementById('checkoutForm');
    const successModal = document.getElementById('successModal');
    const closeSuccessModal = document.getElementById('closeSuccessModal');
    const backdropEl = document.getElementById('backdrop');
    const currentYearEl = document.getElementById('currentYear');
    const mainLogoEl = document.getElementById('mainLogo');
    
    // Dedicated Product Page Refs
    const pageProductEl = document.getElementById('page-product');
    const backToShopBtn = document.getElementById('backToShopBtn');
    const galleryTrack = document.getElementById('galleryTrack');
    const galleryPrev = document.getElementById('galleryPrev');
    const galleryNext = document.getElementById('galleryNext');
    const galleryDots = document.getElementById('galleryDots');
    const galleryThumbs = document.getElementById('galleryThumbs');
    const detailName = document.getElementById('detailName');
    const detailDesc = document.getElementById('detailDesc');
    const detailCategory = document.getElementById('detailCategory');
    const detailPrice = document.getElementById('detailPrice');
    const detailOptions = document.getElementById('detailOptions');
    const detailAddToCart = document.getElementById('detailAddToCart');

    // Floating Buttons
    const scrollTopBtn = document.getElementById('scrollTopBtn');
    const floatingWhatsapp = document.getElementById('floatingWhatsapp');

    const formatPrice = (value) => `${value.toLocaleString('ar-EG')} Ø¬Ù†ÙŠÙ‡`;

    // --- Fetch Data ---
    async function fetchData() {
      let data;
      try {
        const response = await fetch('products.json');
        if(!response.ok) throw new Error("HTTP error " + response.status);
        data = await response.json();
      } catch (error) {
        console.log("Fetching failed (expected in preview), using fallback.");
        data = { hero_categories: [], products: {}, config: {} }; 
      }
      
      // Config (Logo)
      if(data.config && data.config.logo) {
          mainLogoEl.src = data.config.logo;
          mainLogoEl.style.display = 'block';
          if(mainLogoEl.nextElementSibling) mainLogoEl.nextElementSibling.style.display = 'none';
      }
      
      // Process Data
      state.heroCategories = data.hero_categories || [];
      renderHeroCategories();

      let flattenedProducts = [];
      if(data.products) {
          for (const [category, items] of Object.entries(data.products)) {
            items.forEach(item => {
              item.category = category;
              if(!item.images && item.image) item.images = [item.image];
              // Ensure images array exists
              if(!item.images) item.images = ['images/placeholder.jpg'];
              const prices = Object.values(item.sizes);
              item.basePrice = Math.min(...prices); 
              item.createdAt = item.isNew ? Date.now() : 0; 
              flattenedProducts.push(item);
            });
          }
      }
      state.fullCatalog = flattenedProducts;
      filterAndRenderProducts();
    }

    function renderHeroCategories() {
        if(!heroCategoriesContainer) return;
        const categories = state.heroCategories || [];
        // Elegant Category Cards
        heroCategoriesContainer.innerHTML = categories.map(cat => `
            <a href="#" data-navigate-shop="${cat.id}" class="home-category-card group w-full h-56 lg:h-auto lg:aspect-[3/4] relative overflow-hidden bg-slate-100 block">
              <img src="${cat.image}" alt="${cat.title}" class="w-full h-full object-cover">
              <div class="absolute inset-0 bg-black/20 group-hover:bg-black/10 transition-colors duration-500"></div>
              <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-6 text-white z-10">
                 <h2 class="text-3xl font-bold mb-2 drop-shadow-md tracking-wide">${cat.title}</h2>
                 <p class="text-sm opacity-90 mb-6 font-light drop-shadow-sm max-w-[80%]">${cat.subtitle}</p>
                 <span class="inline-block border border-white/60 bg-white/10 backdrop-blur-sm px-6 py-2 rounded-full text-xs font-bold hover:bg-white hover:text-luna-800 transition-all transform translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 duration-300">
                    ØªØ³ÙˆÙ‚ÙŠ Ø§Ù„Ø¢Ù†
                 </span>
              </div>
            </a>
        `).join('');

        document.querySelectorAll('[data-navigate-shop]').forEach((el) => {
            el.addEventListener('click', (e) => {
                e.preventDefault();
                state.activeShopTab = el.getAttribute('data-navigate-shop');
                navigateTo('shop');
            });
        });
    }

    // --- Navigation System ---
    function showView(viewName) {
        // Hide all views
        ['page-home', 'page-shop', 'page-product'].forEach(id => {
            document.getElementById(id).classList.add('hidden');
        });
        
        // Show target view
        const target = document.getElementById(`page-${viewName}`);
        if(target) target.classList.remove('hidden');

        // Handle Floating Button Visibility
        if(viewName === 'home') {
            floatingWhatsapp.classList.remove('visible');
        } else {
            floatingWhatsapp.classList.add('visible');
        }

        window.scrollTo(0,0);
        document.getElementById('mobileNav').classList.add('hidden');
        
        // Update Filters UI if Shop
        if (viewName === 'shop') {
            updateFilterUI();
            filterAndRenderProducts();
        }
    }

    function navigateTo(view, data = null) {
        // If going to product page, setup data first
        if(view === 'product' && data) {
            setupProductPage(data);
        }
        
        showView(view);
        history.pushState({ view: view, data: data }, '', '');
    }

    window.addEventListener('popstate', (event) => {
        // Close modals first if open
        if(cartSidebarEl.style.transform === 'translateX(0px)') {
            _closeCartSidebar();
            return;
        }
        if(checkoutModal.classList.contains('is-visible')) {
            _closeCheckout();
            return;
        }

        const state = event.state;
        if (!state) {
            showView('home');
        } else {
            if(state.view === 'product' && state.data) setupProductPage(state.data);
            showView(state.view || 'home');
        }
    });
    
    // Initial State
    history.replaceState({ view: 'home' }, '', '');

    // Bind Nav Links
    document.querySelectorAll('[data-nav]').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const key = btn.getAttribute('data-nav');
        if (key === 'home' || key === 'shop') {
            navigateTo(key);
        } else {
            navigateTo('home'); 
            const mapping = { about: '#section-about', contact: '#section-contact' };
            setTimeout(() => {
                const target = document.querySelector(mapping[key]);
                if (target) target.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }
      });
    });

    document.getElementById('mobileMenuToggle')?.addEventListener('click', () => {
      document.getElementById('mobileNav').classList.toggle('hidden');
    });

    // --- Shop Logic ---
    document.querySelectorAll('.shop-tab').forEach((btn) => {
      btn.addEventListener('click', () => {
        state.activeShopTab = btn.getAttribute('data-shop-tab');
        updateFilterUI();
        filterAndRenderProducts();
      });
    });

    function updateFilterUI() {
      document.querySelectorAll('.shop-tab').forEach(t => {
        t.classList.toggle('active', state.activeShopTab === t.getAttribute('data-shop-tab'));
      });
      const titleEl = document.getElementById('shopPageTitle');
      const titles = { perfume: 'Ø§Ù„Ø¹Ø·ÙˆØ±', makeup: 'Ø§Ù„Ù…ÙƒÙŠØ§Ø¬', skincare: 'Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø©' };
      if(titleEl) titleEl.textContent = titles[state.activeShopTab] || 'Ø§Ù„Ù…ØªØ¬Ø±';
    }

    priceFilterEl?.addEventListener('change', () => { state.priceFilter = priceFilterEl.value; filterAndRenderProducts(); });
    sortSelectEl?.addEventListener('change', () => { state.sortMode = sortSelectEl.value; filterAndRenderProducts(); });
    
    const handleSearch = (e) => { 
        state.searchQuery = e.target.value.trim(); 
        if(state.searchQuery.length > 0 && document.getElementById('page-shop').classList.contains('hidden')) {
            navigateTo('shop');
        }
        filterAndRenderProducts(); 
    };
    searchInputEl?.addEventListener('input', handleSearch);
    mobileSearchInputEl?.addEventListener('input', handleSearch);

    function filterAndRenderProducts() {
      let result = state.fullCatalog.filter(p => {
        if (state.activeShopTab && state.activeShopTab !== 'all' && p.category !== state.activeShopTab) return false;
        if (state.priceFilter !== 'all') {
          const [minStr, maxStr] = state.priceFilter.split('-');
          const min = parseInt(minStr) || 0;
          const max = maxStr === '+' ? Infinity : (parseInt(maxStr) || Infinity);
          if (p.basePrice < min || p.basePrice > max) return false;
        }
        if (state.searchQuery) {
          const q = state.searchQuery.toLowerCase();
          const searchStr = (p.name + p.description).toLowerCase();
          if (!searchStr.includes(q)) return false;
        }
        return true;
      });

      if (state.sortMode === 'price-asc') result.sort((a,b) => a.basePrice - b.basePrice);
      else if (state.sortMode === 'price-desc') result.sort((a,b) => b.basePrice - a.basePrice);
      else if (state.sortMode === 'newest') result.sort((a,b) => b.createdAt - a.createdAt);
      // default: featured/random

      renderProductsGrid(result);
    }

    function renderProductsGrid(products) {
      productsGrid.innerHTML = '';

      if (products.length === 0) {
        productsGrid.innerHTML = `<div class="col-span-full text-center py-20 opacity-50 flex flex-col items-center">
            <span class="material-symbols-outlined text-4xl mb-2">sentiment_dissatisfied</span>
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ.</p>
        </div>`;
        return;
      }

      products.forEach(product => {
        const card = document.createElement('article');
        card.className = 'product-card group cursor-pointer';
        
        const price = Math.min(...Object.values(product.sizes));
        const mainImage = product.images[0];

        card.innerHTML = `
          <div class="relative overflow-hidden h-[280px] bg-slate-50">
            <img src="${mainImage}" alt="${product.name}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"></div>
            <button class="absolute bottom-4 right-4 bg-white/90 hover:bg-luna-gold hover:text-white text-luna-800 p-2 rounded-full shadow-md translate-y-12 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300">
                <span class="material-symbols-outlined text-[20px]">visibility</span>
            </button>
          </div>
          <div class="p-4 flex flex-col flex-1">
            <h3 class="text-sm font-bold text-slate-800 truncate mb-1">${product.name}</h3>
            <p class="text-xs text-slate-400 mb-3">${product.description.substring(0,40)}...</p>
            <div class="mt-auto flex items-center justify-between">
               <span class="text-sm font-bold text-luna-600">${formatPrice(price)}</span>
               <span class="text-[10px] text-luna-400 px-2 py-1 bg-luna-50 rounded-md">Ø§Ø¶ØºØ·ÙŠ Ù„Ù„ØªÙØ§ØµÙŠÙ„</span>
            </div>
          </div>
        `;
        
        card.addEventListener('click', () => navigateTo('product', product));
        productsGrid.appendChild(card);
      });
    }

    // --- Dedicated Product Page Logic ---
    let galleryImages = [];
    
    function setupProductPage(product) {
        state.currentProduct = product;
        galleryImages = product.images;
        state.currentGalleryIndex = 0;

        // Populate Info
        detailName.textContent = product.name;
        detailDesc.textContent = product.description;
        const catMap = { perfume: 'Ø¹Ø·ÙˆØ± ÙØ§Ø®Ø±Ø©', makeup: 'Ù…Ø³ØªØ­Ø¶Ø±Ø§Øª ØªØ¬Ù…ÙŠÙ„', skincare: 'Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø©' };
        detailCategory.textContent = catMap[product.category] || 'Ù…Ù†ØªØ¬ Ù…Ù…ÙŠØ²';

        // Options (Sizes & Shades)
        detailOptions.innerHTML = '';
        const sizeKeys = Object.keys(product.sizes);
        let selectedSize = sizeKeys[0];
        let selectedShade = (product.shades && product.shades.length) ? product.shades[0] : null;

        // Size Selector
        const sizeContainer = document.createElement('div');
        sizeContainer.innerHTML = `<label class="text-xs font-bold text-slate-500 mb-2 block uppercase">Ø§Ù„Ø­Ø¬Ù…</label>`;
        const sizeBtnsWrapper = document.createElement('div');
        sizeBtnsWrapper.className = 'flex flex-wrap gap-2';
        sizeKeys.forEach(size => {
            const btn = document.createElement('button');
            btn.className = `variant-btn ${size === selectedSize ? 'active' : ''}`;
            btn.textContent = size;
            btn.onclick = () => {
                selectedSize = size;
                updatePrice(product.sizes[size]);
                sizeBtnsWrapper.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            };
            sizeBtnsWrapper.appendChild(btn);
        });
        sizeContainer.appendChild(sizeBtnsWrapper);
        detailOptions.appendChild(sizeContainer);

        // Shade Selector
        if(product.shades && product.shades.length > 0) {
            const shadeContainer = document.createElement('div');
            shadeContainer.innerHTML = `<label class="text-xs font-bold text-slate-500 mb-2 block uppercase mt-4">Ø§Ù„Ø¯Ø±Ø¬Ø©</label>`;
            const shadeBtnsWrapper = document.createElement('div');
            shadeBtnsWrapper.className = 'flex flex-wrap gap-2';
            product.shades.forEach(shade => {
                const btn = document.createElement('button');
                btn.className = `variant-btn ${shade === selectedShade ? 'active' : ''}`;
                btn.textContent = shade;
                btn.onclick = () => {
                    selectedShade = shade;
                    shadeBtnsWrapper.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                };
                shadeBtnsWrapper.appendChild(btn);
            });
            shadeContainer.appendChild(shadeBtnsWrapper);
            detailOptions.appendChild(shadeContainer);
        }

        // Initial Price
        updatePrice(product.sizes[selectedSize]);

        // Add to Cart Action
        detailAddToCart.onclick = () => {
            addToCart(product, selectedSize, product.sizes[selectedSize], selectedShade);
            // Optional: Give feedback button changed state temporarily
            const originalHTML = detailAddToCart.innerHTML;
            detailAddToCart.innerHTML = `<span class="material-symbols-outlined">check</span> ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©`;
            detailAddToCart.classList.add('bg-green-600', '!text-white');
            setTimeout(() => {
                detailAddToCart.innerHTML = originalHTML;
                detailAddToCart.classList.remove('bg-green-600', '!text-white');
            }, 1500);
        };

        // Render Gallery
        renderGallery();
    }

    function updatePrice(price) {
        detailPrice.textContent = formatPrice(price);
    }

    // --- Gallery Carousel Logic ---
    function renderGallery() {
        galleryTrack.innerHTML = '';
        galleryDots.innerHTML = '';
        galleryThumbs.innerHTML = '';

        // Slides
        galleryImages.forEach((src, idx) => {
            const img = document.createElement('img');
            img.src = src;
            img.className = 'gallery-img';
            galleryTrack.appendChild(img);

            // Dot
            const dot = document.createElement('div');
            dot.className = `gallery-dot ${idx === 0 ? 'active' : ''}`;
            galleryDots.appendChild(dot);

            // Thumb
            if(galleryImages.length > 1) {
                const thumb = document.createElement('img');
                thumb.src = src;
                thumb.className = `w-16 h-16 object-cover rounded-md border-2 cursor-pointer transition ${idx === 0 ? 'border-luna-gold opacity-100' : 'border-transparent opacity-60'}`;
                thumb.onclick = () => updateGallery(idx);
                galleryThumbs.appendChild(thumb);
            }
        });

        if(galleryImages.length > 1) {
            galleryPrev.classList.remove('hidden');
            galleryNext.classList.remove('hidden');
        } else {
            galleryPrev.classList.add('hidden');
            galleryNext.classList.add('hidden');
        }
        
        updateGallery(0);
    }

    function updateGallery(index) {
        if(index < 0) index = galleryImages.length - 1;
        if(index >= galleryImages.length) index = 0;
        
        state.currentGalleryIndex = index;
        
        // Move Track
        const percent = index * 100;
        galleryTrack.style.transform = `translateX(${percent}%)`; // RTL: +% moves right image into view? No, in RTL translateX moves differently? 
        // In standard CSS transform, translateX(-100%) moves left. 
        // Let's test standard logic. Usually for RTL carousels we might need positive values or standard negative.
        // Actually, just using standard flex-direction: row (which follows RTL) means 1st image is on right. 
        // So to show 2nd image (on left of 1st), we need to move track to the Right (+100%).
        galleryTrack.style.transform = `translateX(${percent}%)`;

        // Update UI
        Array.from(galleryDots.children).forEach((d, i) => d.classList.toggle('active', i === index));
        if(galleryThumbs.children.length) {
            Array.from(galleryThumbs.children).forEach((t, i) => {
                t.className = `w-16 h-16 object-cover rounded-md border-2 cursor-pointer transition ${i === index ? 'border-luna-gold opacity-100' : 'border-transparent opacity-60'}`;
            });
        }
    }

    galleryPrev.onclick = () => updateGallery(state.currentGalleryIndex - 1);
    galleryNext.onclick = () => updateGallery(state.currentGalleryIndex + 1);

    // Swipe Support
    let touchStartX = 0;
    let touchEndX = 0;
    const galleryContainer = document.getElementById('productGallery');
    
    galleryContainer.addEventListener('touchstart', e => {
        touchStartX = e.changedTouches[0].screenX;
    });
    
    galleryContainer.addEventListener('touchend', e => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    });
    
    function handleSwipe() {
        const threshold = 50;
        if (touchEndX < touchStartX - threshold) {
            // Swiped Left -> Next Image (in RTL visual flow, swipe left usually implies moving to content on right? No, standard logic: Swipe Left gesture means 'Next')
            // In RTL, 'Next' item is to the Left. So swipe right-to-left.
            updateGallery(state.currentGalleryIndex + 1);
        }
        if (touchEndX > touchStartX + threshold) {
            // Swiped Right -> Prev Image
            updateGallery(state.currentGalleryIndex - 1);
        }
    }

    backToShopBtn.onclick = () => {
        history.back(); // Use history to ensure state consistency
    };

    // --- Cart Logic ---
    function loadCartFromStorage() { try { state.cart = JSON.parse(localStorage.getItem('lunabelle_cart')) || []; } catch(e) { state.cart = []; } }
    function saveCart() { localStorage.setItem('lunabelle_cart', JSON.stringify(state.cart)); renderCart(); }

    function addToCart(product, size, price, shade) {
      const cartItemId = `${product.id}-${size}-${shade || 'none'}`;
      const existing = state.cart.find(i => i.cartItemId === cartItemId);
      if (existing) existing.quantity++;
      else state.cart.push({ cartItemId, productId: product.id, name: product.name, size, shade, price, image: product.images[0], quantity: 1 });
      saveCart();
      _openCartSidebar();
    }

    function renderCart() {
      cartItemsContainerEl.innerHTML = '';
      let total = 0, count = 0;
      state.cart.forEach((item, idx) => {
        total += item.price * item.quantity; count += item.quantity;
        const div = document.createElement('div');
        div.className = 'flex gap-4 p-3 bg-white rounded-lg border border-luna-100 shadow-sm';
        div.innerHTML = `
          <div class="w-16 h-16 shrink-0 rounded-md overflow-hidden bg-luna-50"><img src="${item.image}" class="w-full h-full object-cover" /></div>
          <div class="flex flex-col flex-1 justify-center gap-1">
            <div class="text-sm font-bold text-slate-800">${item.name}</div>
            <div class="text-xs text-slate-500">${item.size} ${item.shade ? '| ' + item.shade : ''}</div>
            <div class="flex items-center justify-between mt-1">
                <div class="text-xs font-bold text-luna-700">${formatPrice(item.price)}</div>
                <div class="flex items-center gap-3">
                   <span class="text-xs text-slate-400">x${item.quantity}</span>
                   <button class="text-red-400 hover:text-red-600" data-del="${idx}"><span class="material-symbols-outlined text-[18px]">delete</span></button>
                </div>
            </div>
          </div>`;
        div.querySelector('[data-del]').addEventListener('click', () => { state.cart.splice(idx, 1); saveCart(); });
        cartItemsContainerEl.appendChild(div);
      });
      cartCountEl.textContent = count;
      cartCountEl.style.transform = count > 0 ? 'scale(1)' : 'scale(0)';
      cartSubtotalEl.textContent = formatPrice(total);
      document.getElementById('cartSidebarSubtitle').textContent = count === 0 ? 'Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©' : `${count} Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø©`;
    }

    function _openCartSidebar() { cartSidebarEl.style.transform = 'translateX(0)'; backdropEl.classList.add('is-visible'); }
    function _closeCartSidebar() { cartSidebarEl.style.transform = 'translateX(100%)'; backdropEl.classList.remove('is-visible'); }

    cartToggleEl?.addEventListener('click', _openCartSidebar);
    cartSidebarCloseEl?.addEventListener('click', _closeCartSidebar);
    backdropEl?.addEventListener('click', () => { 
        _closeCartSidebar(); 
        _closeCheckout(); 
    });

    // Checkout
    openCheckoutModalBtn?.addEventListener('click', () => {
        if(state.cart.length === 0) { alert('Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©!'); return; }
        _closeCartSidebar();
        checkoutModal.classList.add('is-visible');
        backdropEl.classList.add('is-visible'); // ensure backdrop stays
    });
    
    function _closeCheckout() {
        checkoutModal.classList.remove('is-visible');
        successModal.classList.remove('is-visible');
        backdropEl.classList.remove('is-visible');
    }
    closeCheckoutModal.onclick = _closeCheckout;
    closeSuccessModal.onclick = _closeCheckout;

    checkoutForm?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('confirmOrderBtn');
        const originalText = btn.textContent;
        btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
        btn.disabled = true;

        // Gather Data
        const name = document.getElementById('customerName').value;
        const phone = document.getElementById('customerPhone').value;
        const address = document.getElementById('customerAddress').value;

        let messageBody = `Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:\nØ§Ù„Ø§Ø³Ù…: ${name}\nØ§Ù„Ù‡Ø§ØªÙ: ${phone}\nØ§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}\n\nØ§Ù„Ø·Ù„Ø¨:\n`;
        state.cart.forEach(item => {
            messageBody += `- ${item.name} | ${item.size} ${item.shade ? ' | '+item.shade : ''} | x${item.quantity} | ${item.price * item.quantity} Ø¬.Ù…\n`;
        });
        messageBody += `\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${cartSubtotalEl.textContent}`;

        const formData = new FormData();
        formData.append("message", messageBody);
        formData.append("customer_name", name);

        try {
            const response = await fetch(FORMSPREE_ENDPOINT, {
                method: 'POST', body: formData, headers: { 'Accept': 'application/json' }
            });
            if (response.ok) {
                state.cart = []; saveCart();
                checkoutForm.reset();
                checkoutModal.classList.remove('is-visible');
                successModal.classList.add('is-visible'); 
                backdropEl.classList.add('is-visible');
            } else {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.");
            }
        } catch (error) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„."); } 
        finally { btn.textContent = originalText; btn.disabled = false; }
    });

    // --- Scroll To Top ---
    window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
            scrollTopBtn.classList.add('visible');
        } else {
            scrollTopBtn.classList.remove('visible');
        }
    });

    scrollTopBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Init
    window.addEventListener('DOMContentLoaded', () => {
      loadCartFromStorage(); renderCart(); fetchData();
      if(currentYearEl) currentYearEl.textContent = new Date().getFullYear();
    });
  </script>
</body>
</html>

